<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:pageModels="clr-namespace:SolarLab.AdvertBoard.Mobile.Presentation.PageModels"      
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="SolarLab.AdvertBoard.Mobile.Presentation.Pages.AdvertDetailsPage"
             Title="Объявление">

    <CollectionView x:Name="MainCollectionView">

        <CollectionView.Header>
            <VerticalStackLayout Padding="16" Spacing="16">

                <Label Text="{Binding Advert.Title}" FontSize="22" FontAttributes="Bold" />

                <!-- Горизонтальная карусель -->
                <CollectionView ItemsSource="{Binding AdvertImages}" HeightRequest="250" HorizontalScrollBarVisibility="Never">
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout Orientation="Horizontal" ItemSpacing="8"/>
                    </CollectionView.ItemsLayout>
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame HasShadow="True" CornerRadius="8" Padding="0">
                                <Image Source="{Binding .}" 
                                       Aspect="AspectFill" 
                                       WidthRequest="250" 
                                       HeightRequest="250" 
                                       BackgroundColor="LightGray"/>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- Остальные элементы страницы -->
                <Label Text="{Binding Advert.Price, StringFormat='{0:C0}'}" FontSize="20" FontAttributes="Bold" TextColor="#008000"/>
                <Label Text="{Binding Advert.CategoryTitle}" FontSize="14" TextColor="#777"/>
                <Label Text="{Binding Advert.Description}" FontSize="16" LineBreakMode="WordWrap"/>

                <VerticalStackLayout>
                    <Label Text="Контакты продавца" FontSize="16" FontAttributes="Bold"/>
                    <Label Text="{Binding Advert.AuthorContacts.FullName}" />
                    <Label Text="{Binding Advert.AuthorContacts.ContactEmail}" />
                    <Label Text="{Binding Advert.AuthorContacts.PhoneNumber}" />
                </VerticalStackLayout>

                <Label Text="{Binding Advert.CommentsCount, StringFormat='Комментариев: {0}'}"
                       FontSize="14" TextColor="#777"/>

                <!-- Кнопка показать/скрыть (только если есть комментарии) -->
                <Button Text="{Binding ToggleCommentsButtonText}"
                        Command="{Binding ToggleCommentsCommand}"
                        IsVisible="{Binding ShowToggleCommentsButton}" />

                <!-- Контейнер для анимации комментариев -->
                <Grid x:Name="CommentsContainer"
                      IsVisible="{Binding CommentsVisible}"
                      Opacity="0"
                      ScaleY="0"
                      AnchorY="0">
                    <CollectionView ItemsSource="{Binding Comments}"
                                    HeightRequest="300">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame CornerRadius="8" Padding="8" Margin="0,4" BackgroundColor="#eee">
                                    <VerticalStackLayout>
                                        <Label Text="{Binding FullName}" FontAttributes="Bold"/>
                                        <Label Text="{Binding Text}" LineBreakMode="WordWrap"/>
                                        <Label Text="{Binding CreatedAt, StringFormat='{0:dd.MM.yyyy HH:mm}'}"
                                               FontSize="12" TextColor="#666"/>
                                    </VerticalStackLayout>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </Grid>

                <!-- Кнопка оставить комментарий -->
                <Button Text="Добавить комментарий"
                        IsEnabled="False"
                        Margin="0,8,0,0"
                        IsVisible="{Binding AddCommentVisible}" />

            </VerticalStackLayout>
        </CollectionView.Header>

    </CollectionView>

</ContentPage>
